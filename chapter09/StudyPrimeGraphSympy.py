# 素数計数関数 π(x) と近似式（x/log x, li(x)）の比較プロット
# -----------------------------------------------------------------------------
# 目的
# - 素数計数関数 π(x) = 「x 以下の素数の個数」を実際に計算し、
#   素数定理（Prime Number Theorem, PNT）で知られる近似
#     x / log x
#   および、より精度が良いことが多い近似
#     li(x)（対数積分）
#   と比較して可視化する。
#
# 背景（素数定理）
# - 素数定理は
#     π(x) ~ x / log x   （x→∞）
#   を主張する（~ は比が 1 に近づくこと）。
# - さらに、経験的には対数積分 li(x) の方が π(x) に近いことが多い。
#   （ただし li(x) - π(x) の符号がいつか反転することも知られている：Skewes数の話題）
#
# このコードの設計
# - sympy.primepi(x) で π(x) を厳密に計算（x が小さい範囲なら現実的に計算できる）
# - x/log x と li(x) を同じグラフに重ねる
# - x = 2..999 の範囲でプロットする
#
# 注意
# - x/log x は x=1 付近で発散するので、x>=2 にしている。
# - li(x) は x=1 に特異点があるため、定義や数値計算上の扱いに注意が必要。
#   ここでは x>=2 の範囲なので問題が起きにくい。
#
# 使用ライブラリ
# - sympy: primepi による素数計数
# - numpy: ベクトル計算、配列生成
# - matplotlib: 描画
# - scipy.special: expi（指数積分）を使って li(x) を計算


import sympy
import numpy as np
import matplotlib.pyplot as plt
from scipy import special


def logint(x):
    # 対数積分 li(x) を数値的に計算する関数
    #
    # 定義（principal value を含む）:
    #   li(x) = PV ∫_{0}^{x} dt / log t
    # 実用上は、指数積分 Ei を使って
    #   li(x) = Ei(log x)
    # と表せる（x>0, x≠1 の範囲で扱うのが一般的）。
    #
    # SciPy の special.expi は Ei を返す関数。
    # したがって li(x) を
    #   li(x) = Ei(log x)
    # として実装している。
    #
    # 注意:
    # - log x を取るので x は正である必要がある。
    # - x=1 だと log(1)=0 になり Ei(0) は定義されるが、li(x) の元の積分には特異点がある。
    return special.expi(np.log(x))


# sympy.primepi はスカラー入力を想定するので、配列 x に対して使えるよう vectorize する。
# - np.vectorize は便利なラッパであり高速化ではないが、ここでは x<=1000 なので十分。
primepiv = np.vectorize(sympy.primepi)

# -----------------------------------------------------------------------------
# x の範囲設定
# -----------------------------------------------------------------------------
# 2 から 999 までの整数列を作る（arange の終端は含まれない）
x = np.arange(2, 1000)

# -----------------------------------------------------------------------------
# 1) 厳密な π(x)
# -----------------------------------------------------------------------------
# primepiv(x) は配列 x の各要素に対して π(x) を計算し、配列として返す。
plt.plot(x, primepiv(x))

# -----------------------------------------------------------------------------
# 2) 近似1: x / log x  （素数定理の基本近似）
# -----------------------------------------------------------------------------
# π(x) ~ x/log x をそのまま描く。
# x が大きいほど π(x) に近づくはずだが、小さい範囲ではズレが目立つこともある。
plt.plot(x, x / np.log(x))

# -----------------------------------------------------------------------------
# 3) 近似2: li(x) = Ei(log x)  （対数積分近似）
# -----------------------------------------------------------------------------
# 経験的に x/log x より π(x) に近いことが多い近似。
plt.plot(x, logint(x))

# -----------------------------------------------------------------------------
# 仕上げ（ラベル）
# -----------------------------------------------------------------------------
plt.xlabel('x')
plt.ylabel('Number of primes below x')

# 凡例があるとどの線がどれか分かりやすいが、元コードでは省略されている。
# 必要なら plt.legend([...]) を追加すると良い。

plt.show()
