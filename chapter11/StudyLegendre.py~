# ルジャンドル記号（Legendre symbol）(a/p) を計算する関数
# -----------------------------------------------------------------------------
# 目的
# - 奇素数 p に対して、a が p を法として「平方剰余（quadratic residue）」かどうかを判定する。
# - ルジャンドル記号 (a/p) は以下の値を取る：
#
#   (a/p) =
#     0   （a ≡ 0 mod p のとき）
#     1   （a が p を法として平方剰余のとき：∃x, x^2 ≡ a (mod p)）
#    -1   （a が p を法として平方非剰余のとき：平方根が存在しない）
#
# 暗号理論での用途
# - 平方剰余の判定は、Tonelli–Shanks による平方根計算、
#   Blum整数、Rabin暗号、楕円曲線上の平方根、ゼロ知識証明など多くの場面で現れる。
#
# -----------------------------------------------------------------------------
# オイラーの判定法（Euler's criterion）
# -----------------------------------------------------------------------------
# p を奇素数、a を p で割った剰余（a mod p）とする。
#
# Euler の判定法：
#
#   a^{(p-1)/2} ≡
#     0   (mod p)   （a ≡ 0）
#     1   (mod p)   （a は平方剰余）
#    -1   (mod p)   （a は平方非剰余）
#
# よって、
#   (a/p) ≡ a^{(p-1)/2} (mod p)
# が成り立ち、これを使って (a/p) を計算できる。
#
# 本コードはこの Euler の判定法を pow(a, (p-1)//2, p) で実装している。
#
# -----------------------------------------------------------------------------
# 実装上の注意
# -----------------------------------------------------------------------------
# - p は「奇素数」である必要がある（合成数だと Euler 判定はルジャンドル記号にならない）。
#   合成数の一般化はヤコビ記号（Jacobi symbol）で扱う。
# - a は任意の整数でよいが、内部的には a mod p で考えて良い（pow が自動的にそうなる）。
# - pow(x, e, p) は高速な繰り返し二乗法で x^e mod p を計算する。


def Legendre(a, p):
    # Euler の判定法により L = a^{(p-1)/2} mod p を計算する
    # - 戻り値は 0..p-1 の範囲の剰余として返ってくる
    L = pow(a, (p - 1) // 2, p)

    # Euler 判定の結果が p-1 のとき、それは mod p で -1 を意味するので、
    # 使いやすいように -1 に直す
    #
    # 例: p=7 のとき、-1 mod 7 は 6 なので、L==6 なら -1 にする
    if L == p - 1:
        L = -1

    # L は 0, 1, -1 のいずれかになる（p が奇素数である限り）
    return L
