# SymPy で「楕円曲線 y^2 = x^3 + a x + b」の判別式（discriminant）を導くコード
# -----------------------------------------------------------------------------
# 目的
# - Weierstrass 形式の楕円曲線
#
#     E: y^2 = x^3 + a x + b
#
# が「非特異（nonsingular）」である条件を、記号計算で導く。
#
# 楕円曲線が楕円曲線として成立するための重要条件
# - 曲線が “とがった点（尖点）” や “自己交差” を持たないこと（特異点がないこと）。
# - これは多項式 f(x)=x^3 + a x + b が「重根（重複する根）」を持たないことと同値。
#
# 判別式 Δ（discriminant）
# - 三次多項式 f(x)=x^3 + a x + b の判別式は
#
#     Δ = -16(4a^3 + 27b^2)
#
# であり、楕円曲線が非特異である条件は
#
#     Δ ≠ 0
#
# である。
#
# このコードは、判別式の導出を「resultant（終結式）」で計算する。
#
# -----------------------------------------------------------------------------
# resultant を使う理由（アルゴリズムの核）
# -----------------------------------------------------------------------------
# 多項式 f(x) が重根を持つ ⇔ f(x) と f'(x) が共通根を持つ
# つまり
#   gcd(f, f') ≠ 1
# が成り立つ。
#
# 「2つの多項式が共通根を持つか」は resultant で判定できる：
# - res_x(f, g) = 0  ⇔  f と g が共通根を持つ（体上で）
#
# ここで g = f'(x) とすると、
# - resultant(f, f', x) が 0 になる条件が「重根がある条件」＝判別式が 0 になる条件に一致する。
#
# 実際、三次多項式の判別式は
# - disc(f) = (-1)^{n(n-1)/2} * (1/leading_coeff) * resultant(f, f')
# のように resultant と定数倍関係にある。
# このため resultant を計算すれば判別式（に比例する式）が得られる。
#
# -----------------------------------------------------------------------------
# このコードがやっていること（流れ）
# -----------------------------------------------------------------------------
# 1) 記号 x,y,a,b,D を用意
# 2) f(x) = x^3 + a x + b を定義
# 3) g(x) = f'(x) = 3x^2 + a を定義
# 4) D = resultant(f, g, x) を計算
# 5) D を表示
#
# 期待される結果の形
# - resultant(f, f') は 4a^3 + 27b^2 に比例する（符号や定数倍が付く）
# - それが 0 でないことが非特異条件になる。
#
# 注意
# - ここでの D は「判別式そのもの」ではなく「判別式に比例する式」になる場合がある。
#   ただし 0/非0 の判定（特異かどうか）には定数倍の違いは影響しない。


import sympy

# -----------------------------------------------------------------------------
# 1) 記号（シンボル）の定義
# -----------------------------------------------------------------------------
# x: 多項式の変数
# a,b: 楕円曲線のパラメータ
# y は今回の計算では使わないが、曲線の式 y^2 = ... を意識して宣言している
x, y, a, b, D = sympy.symbols("x y a b D")

# -----------------------------------------------------------------------------
# 2) f(x) = x^3 + a x + b を定義
# -----------------------------------------------------------------------------
# 楕円曲線の右辺の三次多項式
f = x**3 + a*x + b

# -----------------------------------------------------------------------------
# 3) g(x) = f'(x) = 3x^2 + a を定義
# -----------------------------------------------------------------------------
# f の導関数。重根があるとき f と f' は共通根を持つ。
g = 3*x**2 + a

# -----------------------------------------------------------------------------
# 4) 終結式（resultant）の計算
# -----------------------------------------------------------------------------
# resultant(f, g, x) は「変数 x について f と g の終結式」を計算する。
# - これが 0 になる ⇔ f と g が共通根を持つ ⇔ f が重根を持つ ⇔ 曲線が特異
D = sympy.resultant(f, g, x)

# -----------------------------------------------------------------------------
# 5) 表示
# -----------------------------------------------------------------------------
# ここで出力される D は 4a^3 + 27b^2 に比例するはず。
# - D == 0 が特異条件
# - D != 0 が非特異（楕円曲線としてOK）
print(D)
