# 拡張ユークリッドの互除法（Extended Euclidean Algorithm）
# -----------------------------------------------------------------------------
# 目的
# - 与えられた整数 a, b に対して、次を同時に求める：
#   1) g = gcd(a, b)  （最大公約数）
#   2) 係数 x, y（ベズー係数: Bézout coefficients）
#        a*x + b*y = g
#
# これが分かると何が嬉しいか（暗号理論で超重要）
# - a と m が互いに素（gcd(a,m)=1）なら、a の m における逆元 a^{-1} が存在する。
# - 拡張互除法で a*x + m*y = 1 を作れれば、x が a^{-1} (mod m) になる。
#   RSA や ECC、各種有限体演算で頻出。
#
# -----------------------------------------------------------------------------
# アルゴリズムの基本（ユークリッドの互除法の拡張）
# -----------------------------------------------------------------------------
# 通常の互除法は
#   a = b*q + r
#   gcd(a,b) = gcd(b,r)
# を繰り返して gcd を求める。
#
# 拡張版はさらに
#   gcd(b,r) = b*x' + r*y'
# が分かっているとして、r = a - b*q を代入し、
#   gcd(a,b) = b*x' + (a - b*q)*y'
#            = a*y' + b*(x' - q*y')
# と変形し、(a,b) に対する係数を再構成する。
#
# つまり「再帰の戻りがけに係数を更新する」ことで
# a と b の線形結合で gcd を表せる係数が求まる。
#
# -----------------------------------------------------------------------------
# 実装の返り値の意味（ここが混乱ポイント）
# -----------------------------------------------------------------------------
# この関数は (g, x, y) を返し、
#   a*x + b*y = g
# を満たすことを狙っている。
#
# ただし実装上、再帰から (g, y, x) の順で受け取り、最後に (g, x, y) を返している。
# これは「ExtEuclid(b, r) が b*? + r*? = g を返す」ことを踏まえ、
# 係数の割当てを入れ替えて更新しているため。
#
# -----------------------------------------------------------------------------
# 注意点
# - b==0 のとき a を返しているので、負数入力だと gcd が負になる可能性がある。
#   一般には gcd は非負にしたいので abs を取る実装が多い。
# - Python は大きな整数でも扱えるのでオーバーフローは気にしなくてよいが、
#   係数 x,y は負になりうる。
#
# - 関数名は Python の慣習だと ext_euclid のような snake_case が多い。


def ExtEuclid(a, b):
    # 再帰ケース：b != 0 のとき
    # ユークリッドの互除法の1ステップ：
    #   a = b*q + r
    #   q = a//b（商）, r = a%b（余り）
    if b != 0:
        q = a // b  # quotient（商）
        r = a % b   # remainder（余り）

        # 再帰呼び出し：
        #   ExtEuclid(b, r) は
        #     b*x1 + r*y1 = g
        # を満たす (g, x1, y1) を返す…のが通常の定義。
        #
        # ただしこの実装では受け取りを (g, y, x) にしている点に注意。
        # - r = a - b*q を代入するときに、係数を入れ替えて使うため
        g, y, x = ExtEuclid(b, r)

        # ここから「戻りがけの係数更新」：
        # ExtEuclid(b, r) の結果が
        #   b*y + r*x = g
        # という形（受け取りの順の都合）になっているので、
        # r = a - b*q を代入する。
        #
        #   g = b*y + r*x
        #     = b*y + (a - b*q)*x
        #     = a*x + b*(y - q*x)
        #
        # よって (a の係数, b の係数) は
        #   x, (y - q*x)
        # になる。
        y = y - q * x

        # 返り値は (g, x, y) に揃えて返す：
        #   a*x + b*y = g
        return g, x, y

    else:
        # ベースケース：b == 0 のとき
        # gcd(a, 0) = a
        # このとき
        #   a*1 + 0*0 = a
        # なので (g, x, y) = (a, 1, 0) を返す。
        return a, 1, 0
